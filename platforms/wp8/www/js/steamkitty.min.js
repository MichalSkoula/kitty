/*! steamkitty 06-05-2014 */
function backgroundObject(){this.images=[_images.country,_images.country2,_images.country3,_images.country4,_images.country5],this.image1=this.images[0],this.image1id=2,this.image2=this.images[0],this.image2id=1,this.width=this.image1.originalWidth,this.height=this.image1.originalHeight,this.position1=0,this.position2=this.width,this.tick=function(){if(this.position1-=parseInt(4*_game.speed),this.position2-=parseInt(4*_game.speed),this.position1<=-this.width){this.position1=this.width;var a=-1;do a=Math.rand(0,this.images.length-1);while(a==this.image1id);this.image1id=a,this.image1=this.images[a]}if(this.position2<=-this.width){this.position2=this.width;var a=-1;do a=Math.rand(0,this.images.length-1);while(a==this.image2id);this.image2id=a,this.image2=this.images[a]}this.draw()},this.draw=function(){_game.context.drawImage(this.image1,rc(this.position1),0,rc(this.width),rc(this.height)),_game.context.drawImage(this.image2,rc(this.position2),0,rc(this.width),rc(this.height))}}function catObject(a,b,c,d,e,f,g,h){this.name=b,this.id=a,this.health=c,this.x=d,this.y=e,this.image=_images.cat,this.width=parseInt(_images.cat.originalWidth/2),this.height=_images.cat.originalHeight,this.jumpPath=[],this.jetpack=new emitorObject(d,e,12,4,4,2,parseInt(this.width/3),["#fee69a","#fe775d","#3d3d33"],"down"),this.score=0,this.distance=0,this.money=parseInt(g),this.lasty=e,this.suffering=!1,this.screaming=!1,this.milking=!1,this.items=h,this.coinValue=1,this.milkValue=3,this.immortal=0,this.milkyWay=!1,this.draw=function(){var a=parseInt(parseInt(_game.odd/4)*this.width);_game.context.drawImage(this.image,a,0,this.width,this.height,rc(this.x),rc(this.y),rc(this.width),rc(this.height)),this.suffering?(_game.context.globalAlpha=.2,_game.context.fillStyle="red",_game.context.fillRect(0,0,_game.width,_game.height),_game.context.globalAlpha=1):this.milking&&(_game.context.globalAlpha=.2,_game.context.fillStyle="green",_game.context.fillRect(0,0,_game.width,_game.height),_game.context.globalAlpha=1),_game.context.globalAlpha=.5,_game.context.fillStyle="cyan",_game.context.fillRect(rc(650),rc(20),rc(250),rc(110)),_game.context.globalAlpha=1,_game.context.fillStyle="white",_game.context.font=_game.fontsize+"px renegade_masternormal",_game.context.fillText("Score: "+parseInt(this.score),rc(665),rc(50)),_game.context.fillText("Coins: "+parseInt(this.money),rc(665),rc(80)),_game.context.fillText("Health: "+parseInt(this.health)+"%",rc(665),rc(110));var b=170;_game.context.font=_game.fontsize+"px renegade_masternormal",1!=this.coinValue&&(_game.context.globalAlpha=.5,_game.context.fillStyle="red",_game.context.fillRect(rc(650),rc(b),rc(250),rc(50)),_game.context.globalAlpha=1,_game.context.fillStyle="white",_game.context.fillText("Double coins!",rc(665),rc(b+35)),b+=60),1==this.milkyWay&&(_game.context.globalAlpha=.5,_game.context.fillStyle="red",_game.context.fillRect(rc(650),rc(b),rc(250),rc(50)),_game.context.globalAlpha=1,_game.context.fillStyle="white",_game.context.fillText("Milky Way!",rc(665),rc(b+35)),b+=60),0!=this.immortal&&(_game.context.globalAlpha=.5,_game.context.fillStyle="red",_game.context.fillRect(rc(650),rc(b),rc(250),rc(50)),_game.context.globalAlpha=1,_game.context.fillStyle="white",_game.context.fillText("God Mode: "+parseInt(this.immortal/_gameConfig.fps),rc(665),rc(b+35)),b+=60)},this.tick=function(){if(this.lasty=this.y,this.distance++,this.score+=_game.speed,this.suffering=!1,this.immortal>0)_sounds.ingame.pause(),_sounds.hellfire.play(),this.immortal--,_game.speed=_game.immortalSpeed,0==this.immortal&&(_game.speed=1,_sounds.hellfire.pause(),_sounds.ingame.play());else{for(var a=0;a<_game.enemies.length;a++)intersect(this,_game.enemies[a])&&(this.suffering=!0,this.health--);if(this.y<0&&(this.health-=.1,this.suffering=!0),1==this.suffering&&(_game.vibrate(500),0==this.screaming&&"wp8"!=_gameConfig.device)){this.screaming=!0;var b=["pain1","pain2","pain3"];_sounds.pain=_sounds[b[Math.rand(0,b.length-1)]],_sounds.pain.play(),_sounds.pain.on("ended",function(){this.screaming=!1},this)}}if(_game.coins.length>0)for(var a=0;a<_game.coins.length;a++)intersect(this,_game.coins[a])&&(_game.coins.splice(a,1),this.money+=this.coinValue,this.score+=200);if(this.milking=!1,_game.milks.length>0)for(var a=0;a<_game.milks.length;a++)intersect(this,_game.milks[a])&&(_game.milks.splice(a,1),this.health+this.milkValue>100?this.health=100:this.health+=this.milkValue,this.milking=!0);this.jumpPath.length>0?(this.y=this.jumpPath[0],this.jumpPath.splice(0,1),this.jumpPath[0]>this.jumpPath[1]?this.jetpack.turnOn():this.jetpack.turnOff()):this.jetpack.turnOff(),this.jetpack.y=this.y+this.height,this.jetpack.tick(),this.draw()},this.jump=function(){var a=413-this.y,b=11,c=45;0>=a&&(a=1);for(var d=0;200>d;d++){var e=d/3,f=a+c*e-.5*b*e*e;f>=0&&(this.jumpPath[d]=413-Math.round(f))}this.jumpPath.push(413),"wp8"!=_gameConfig.device&&(_sounds.thud.volume(.5),_sounds.thud.play())},this.deleteItems=function(a){for(var b=this.items,c=0;c<this.items.length;c++)for(var d=0;d<a.length;d++)this.items[c].id_item==a[d]&&(b.splice(c,1),jQuery.support.cors=!0,$.getJSON(_game.url+"cat/useItem?id_user="+_cat.id+"&id_item="+a[d],null,function(){}));this.items=b}}function cloudObject(){this.image=_images["cloud"+Math.rand(1,2)],this.x=Math.rand(950,3e3),this.y=Math.rand(5,200),this.height=this.image.originalHeight,this.width=parseInt(this.image.originalWidth/2),this.draw=function(){var a=parseInt(parseInt(_game.odd/4)*this.width);_game.context.drawImage(this.image,a,0,this.width,this.height,rc(this.x),rc(this.y),rc(this.width),rc(this.height))},this.move=function(){this.x-=parseInt(6*_game.speed),this.y+=Math.rand(-1,1)},this.tick=function(){this.move(),this.draw()}}function coinObject(){this.image=_images.coin,this.width=this.image.originalWidth,this.height=this.image.originalHeight,this.x=Math.rand(2500,3200),this.y=Math.rand(0,520-this.height),this.draw=function(){_game.context.drawImage(this.image,rc(this.x),rc(this.y),rc(this.width),rc(this.height))},this.tick=function(){this.x-=parseInt(4*_game.speed),this.draw()}}function emitorObject(a,b,c,d,e,f,g,h,i){this.x=a,this.y=b,this.particlesWidth=d,this.particlesHeight=e,this.particles=[],this.intensity=c,this.realIntensity=c,this.itl=f,this.realItl=f,this.diff=g,this.on=!0,this.colors=h,this.direction=i,this.turnOn=function(){this.realIntensity=1.5*this.intensity,this.realItl=this.itl+1},this.turnOff=function(){this.realIntensity=this.intensity/1.5,this.realItl=this.itl-1},this.emit=function(){var a,b=0;switch(this.direction){case"down":case"up":a=this.x+Math.rand(0,g),b=this.y;break;case"right":a=this.x,b=this.y+Math.rand(0,g)}var c=new particleObject(a,b,this.particlesWidth,this.particlesHeight,this.realItl,h,this.direction);this.particles.push(c)},this.tick=function(){for(var a=0;a<this.particles.length;a++)this.particles[a].itl--,0==this.particles[a].itl&&this.particles.splice(a,1);for(var a=0;a<this.particles.length;a++)this.particles[a].move();if(this.on)for(var b=parseInt(.8*this.realIntensity),c=parseInt(1.2*this.realIntensity),a=0;a<Math.rand(b,c);a++)this.emit();this.draw()},this.draw=function(){for(var a=0;a<this.particles.length;a++)this.particles[a].draw()}}function enemyObject(a,b,c){switch(this.image=_images[a],this.width=parseInt(this.image.originalWidth/2),this.height=this.image.originalHeight,this.type=a,this.x=b,this.y=c,this.bark=null,this.counter=0,a){case"dog1":this.jetpack=new emitorObject(this.x,this.y,25,4,4,4,this.height,["#fee69a","#fe775d","#3d3d33"],"right"),this.bark=_sounds.bark2;break;case"dog2":this.bark=_sounds.bark4;break;case"dog3":this.jetpack=new emitorObject(this.x,this.y+10,15,4,4,3,this.width/4,["#6A6D5C","#AAAC9D"],"up"),this.bark=_sounds.bark3;break;case"dog4":this.jumpPath=[383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,383,378,373,368,363,358,353,348,343,338,333,328,323,318,313,308,313,318,323,328,333,338,343,348,353,358,363,368,373,378,383,383,383,383],this.bark=_sounds.bark1}this.draw=function(){var a=parseInt(parseInt(_game.odd/4)*this.width);_game.context.drawImage(this.image,a,0,this.width,this.height,rc(this.x),rc(this.y),rc(this.width),rc(this.height))},this.tick=function(){var a=1;switch(this.x>900&&(a=-this.x/3100+4e3/3100),this.bark.volume(a),this.counter++,this.counter>59&&(this.counter=0),this.type){case"dog1":this.x-=parseInt(10*_game.speed),this.y+=Math.rand(-3,3),this.jetpack.y=this.y,this.jetpack.x=this.x+this.width,this.jetpack.tick(),"wp8"==_gameConfig.device||50!=this.counter&&15!=this.counter||this.bark.play();break;case"dog2":this.x-=parseInt(6*_game.speed),this.y+=Math.rand(-1,1),"wp8"==_gameConfig.device||5!=this.counter&&35!=this.counter||this.bark.play();break;case"dog3":this.x-=parseInt(9*_game.speed),this.jetpack.x=this.x+10,this.jetpack.tick(),"wp8"!=_gameConfig.device&&10==this.counter&&this.bark.play();break;case"dog4":"wp8"!=_gameConfig.device&&28==this.counter&&this.bark.play(),this.x-=parseInt(7*_game.speed),this.y=this.jumpPath[this.counter]}this.draw()}}function intersect(a,b){return a.x<=b.x+b.width&&b.x<=a.x+a.width&&a.y<=b.y+b.height&&b.y<=a.y+a.height}function rc(a){return parseInt(a*_game.ratio)}function gameObject(a,b,c){this.width=parseInt(1.5*window.innerHeight),this.height=parseInt(window.innerHeight),this.menu_height=parseInt(this.height/12),this.url=_gameConfig.url,this.fps=parseInt(1e3/_gameConfig.fps),this.speed=parseFloat(_gameConfig.speed),this.immortalSpeed=parseInt(_gameConfig.immortalSpeed),this.canvas=a,this.context=b,this.context.textBaseline="top",this.renderInterval=null,this.background=new backgroundObject,this.fontsize=parseInt(this.height/26),this.started=!1,this.odd=1,this.ratio=this.height/600,this.vibrations=0,this.enemyPatterns=jsonEnemies,this.offset=1,this.offset2=-150,this.resize=function(){$("#container").css("width",this.width),$("#container").css("height",this.height),$("#canvas").attr("width",this.width),$("#canvas").attr("height",this.height),$("#back_canvas").attr("width",this.width),$("#back_canvas").attr("height",this.height),$("#controls").css({height:parseInt(this.height-this.menu_height-.02*this.height)+"px"}),$("body,button").css({"font-size":this.fontsize+"px"}),$("#menu").css({height:this.menu_height+"px"}),$("#preload").css({left:window.innerWidth/2-64}),$("#preload").css({top:this.height/2-7})},this.showAd=function(){if("undefined"!=typeof jsonAds[_gameConfig.device]){var a=null;a=this.width>730?jsonAds[_gameConfig.device].ad720:this.width>645?jsonAds[_gameConfig.device].ad640:this.width>470?jsonAds[_gameConfig.device].ad468:jsonAds[_gameConfig.device].ad320,$("#ad").css({width:a.width,height:a.height,top:this.height/1.5,display:"block"}),$("#ad").html(a.content)}},this.hideAd=function(){$("#ad").css({display:"none"})},this.getMousePosition=function(a){var b=this.canvas.getBoundingClientRect(),c=this.width/this.canvas.offsetWidth;return{x:parseInt((a.clientX-b.left)*c),y:parseInt((a.clientY-b.top)*c)}},this.showScore=function(){this.pause(),TINY.box.show({html:"<div style='padding-top:2%'><div id='score_menu'></div> <hr><div id='score_content'></div><br><button style='font-size: "+_game.fontsize+"px' id='close_btn'>close</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){var a="web";switch(_gameConfig.device){case"android":a="Android";break;case"wp8":a="Windows Phone"}-1==_cat.id?$("#score_menu").html("<button style='font-size: "+_game.fontsize+"px' id='globalscore_platform_btn'>global "+a+"</button> | <button style='font-size: "+_game.fontsize+"px' id='globalscore_btn'>global highscore</button>"):($("#score_menu").html("<button style='font-size: "+_game.fontsize+"px' id='myscore_btn'>my</button> | <button style='font-size: "+_game.fontsize+"px' id='globalscore_platform_btn'>global "+a+"</button> | <button style='font-size: "+_game.fontsize+"px' id='globalscore_btn'>global</button>"),$("#myscore_btn").click(function(){var a=encodeURIComponent(_cat.id);_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"score/getMyHighscore?id_user="+a,null,function(a){if(0==a)$("#score_content").html("There was some problem getting your highscore.<br>");else{var b="Your highscore<br><table><tr><th>#</th><th>score</th><th>date</th><th>platform</th></tr>";$.each(a,function(a,c){b+="<tr><td>"+(a+1)+".</td><td>"+c.score+"</td><td>"+c.published+"</td><td>"+c.device+"</td></tr>"}),b+="</table>",$("#score_content").html(b)}_game.hideLoading()})})),$("#close_btn").click(function(){TINY.box.hide(),_game.resume()}),$("#globalscore_platform_btn").click(function(){_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"score/getGlobalPlatformHighscore/"+_gameConfig.device,null,function(b){if(0==b)$("#score_content").html("There was some problem getting the highscore.<br>");else{var c="Global "+a+" Highscore<br><table><tr><th>#</th><th>score</th><th>nick</th><th>date</th></tr>";$.each(b,function(a,b){c+="<tr><td>"+(a+1)+".</td><td>"+b.score+"</td><td>"+b.nick+"</td><td>"+b.published+"</td></tr>"}),c+="</table>",$("#score_content").html(c)}_game.hideLoading()})}),$("#globalscore_btn").click(function(){_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"score/getGlobalHighscore",null,function(a){if(0==a)$("#score_content").html("There was some problem getting the highscore.<br>");else{var b="Global Highscore<br><table><tr><th>#</th><th>score</th><th>nick</th><th>date</th><th>platform</th></tr>";$.each(a,function(a,c){b+="<tr><td>"+(a+1)+".</td><td>"+c.score+"</td><td>"+c.nick+"</td><td>"+c.published+"</td><td>"+c.device+"</td></tr>"}),b+="</table>",$("#score_content").html(b)}_game.hideLoading()})}),$("#score_content").css({height:.7*_game.height+"px"})}})},this.showOptions=function(){this.pause(),TINY.box.show({html:"<div style='padding-top:2%;'><h2>Options</h2><hr><div id='score_content'><br>audio <button style='font-size: "+_game.fontsize+"px' id='audio'>on/off</button><br><br>vibrate <button style='font-size: "+_game.fontsize+"px' id='vibrate'>on/off</button><br><br>retro <button style='font-size: "+_game.fontsize+"px' id='retro'>on/off</button></div><br><button style='font-size: "+_game.fontsize+"px' id='close_btn'>close</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){$("#audio").css("true"==localStorage.audio?{border:"2px dashed #00FF00",color:"#00FF00"}:{border:"2px dashed #FF0000",color:"#FF0000"}),$("#vibrate").css("true"==localStorage.vibrate?{border:"2px dashed #00FF00",color:"#00FF00"}:{border:"2px dashed #FF0000",color:"#FF0000"}),$("#retro").css("true"==localStorage.retro?{border:"2px dashed #00FF00",color:"#00FF00"}:{border:"2px dashed #FF0000",color:"#FF0000"}),$("#audio").click(function(){"true"==localStorage.audio?($("#audio").css({border:"2px dashed #FF0000",color:"#FF0000"}),localStorage.audio="false",_gameConfig.audio="false",_sounds.ingame.pause(),_sounds.street.pause()):"false"==localStorage.audio&&($("#audio").css({border:"2px dashed #00FF00",color:"#00FF00"}),localStorage.audio="true",_gameConfig.audio="true",_game.started?_sounds.ingame.play():_sounds.street.play())}),$("#vibrate").click(function(){"true"==localStorage.vibrate?($("#vibrate").css({border:"2px dashed #FF0000",color:"#FF0000"}),localStorage.vibrate="false",_gameConfig.vibrate="false"):"false"==localStorage.vibrate&&($("#vibrate").css({border:"2px dashed #00FF00",color:"#00FF00"}),localStorage.vibrate="true",_gameConfig.vibrate="true")}),$("#retro").click(function(){"true"==localStorage.retro?($("#retro").css({border:"2px dashed #FF0000",color:"#FF0000"}),localStorage.retro="false",_gameConfig.retro="false"):"false"==localStorage.retro&&($("#retro").css({border:"2px dashed #00FF00",color:"#00FF00"}),localStorage.retro="true",_gameConfig.retro="true")}),$("#close_btn").click(function(){TINY.box.hide()}),$("#score_content").css({height:.69*_game.height+"px"})}})},this.showAbout=function(){this.pause(),TINY.box.show({html:"<div style='padding-top:2%;'><h2>About</h2><hr><div id='score_content' style='text-align:left;padding:1%'><h3>The Story</h3>There was some apocalypse etc. and you, The Kitty, must save the world by stealing the time machine from the evil Steamdogs!<br><br><h3>Enemies summary</h3><table id='about_table'><tr><td><img class='about_img' src='img/dog1_half.png'><h4>Doggy WoW</h4>Speedy steam rocket powered fabulous dog!</td><td><img class='about_img' src='img/dog2_half.png'><h4>Benny I.F.O.</h4>Slow but hi-tech flying dog.</td></tr><tr><td><img class='about_img' src='img/dog3_half.png'><h4>Nanny Cho-Cho</h4>Steaming bitch.</td><td><img class='about_img' src='img/dog4_half.png'><h4>Bully 5</h4>Jumping buldog ready to get you.</td></tr></table><br><h3>market items summary</h3><table id='about_table'><tr><td><img class='about_img2' src='img/milk.png'><h4>Milk Bottle</h4>Fresh milk adds you 3 health points!</td><td><img class='about_img2' src='img/coin.png'><h4>Coin</h4>This shiny coin gives you $1</td></tr></table><br><h3>Authors</h3><br><b>Code, desing</b>: Michal Skoula<br><br><b>music</b>: Zander Noriega, Kris Dudley<br><br><b>sounds</b>: Paulius Jurgelevicius, Michel Baradari, Stigler, bart<br><br>Official site: steamkitty.com</div><br><button style='font-size: "+_game.fontsize+"px' id='close_btn'>close</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){$(".about_img").css({width:.1*_game.width}),$(".about_img2").css({width:.04*_game.width}),$("#close_btn").click(function(){TINY.box.hide()}),$("#score_content").css({height:.66*_game.height+"px"})}})},this.tick=function(){_game.context.clearRect(0,0,this.width,this.height),this.odd++,8==this.odd&&(this.odd=0),this.background.tick(),this.clouds[0].x<0-this.clouds[0].width&&(this.clouds.splice(0,1),this.clouds.push(new cloudObject));for(var a=0;a<this.clouds.length;a++)this.clouds[a].tick();if(0==this.coins.length)for(var b=Math.rand(0,5),a=0;b>a;a++)this.coins.push(new coinObject);else for(var a=0;a<this.coins.length;a++)this.coins[a].tick();if(this.coins.length>0&&this.coins[0].x<0-this.coins[0].width&&this.coins.splice(0,1),0==this.milks.length){var b=Math.rand(0,2);1==_cat.milkyWay&&(b=Math.rand(2,4));for(var a=0;b>a;a++)this.milks.push(new milkObject)}else for(var a=0;a<this.milks.length;a++)this.milks[a].tick();if(this.milks.length>0&&this.milks[0].x<0-this.milks[0].width&&this.milks.splice(0,1),0==this.enemies.length){var c=this.enemyPatterns["p"+Math.rand(0,_.size(_game.enemyPatterns)-1)];$.each(c,function(a,b){_game.enemies.push(new enemyObject(b.type,b.x,b.y))})}this.enemies[0].x<0-this.enemies[0].width&&this.enemies.splice(0,1);for(var a=0;a<this.enemies.length;a++)this.enemies[a].tick();if(_cat.tick(),_cat.health<=0&&(this.stop(),_cat.score=parseInt(_cat.score),TINY.box.show({html:"<div style='padding-top:3%'><h2>GAME OVER</h2><br><br>score: "+_cat.score+"<br><br><div id='score_message'></div><br><button style='font-size: "+_game.fontsize+"px' id='close_btn'>close</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){if(-1==_cat.id)$("#score_message").html("You must be logged in to submit your score.");else{$(this).hide();var a=encodeURIComponent(_cat.score),b=encodeURIComponent(_cat.id),c=encodeURIComponent(_cat.money);_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"cat/gameOver?id_user="+b+"&score="+a+"&money="+c+"&device="+_gameConfig.device,null,function(a){0==a?($("#score_message").html("There was some problem uploading your score and progress.<br>"),$(this).show()):$("#score_message").html("Score successfully uploaded!<br>"),_game.hideLoading()})}$("#close_btn").click(function(){TINY.box.hide()}),_game.drawGameOver()}})),0==_cat.immortal&&(_game.speed=1+_cat.distance/1500),this.vibrations>0&&this.vibrations--,"true"==_gameConfig.retro){this.context.globalAlpha=.3,this.context.strokeStyle="black",this.offset++,6==this.offset&&(this.offset=0);for(var a=0;100>a;a++)this.context.beginPath(),this.context.moveTo(0,rc(6*a+this.offset)),this.context.lineTo(rc(900),rc(6*a+this.offset)),this.context.stroke();this.context.globalAlpha=1,this.offset2+=20,this.offset2>600&&(this.offset2=-150),this.my_gradient=this.context.createLinearGradient(0,rc(this.offset2),0,rc(this.offset2+150)),this.my_gradient.addColorStop(0,"rgba(0, 0, 0, 0)"),this.my_gradient.addColorStop(.5,"rgba(0, 0, 0, 0.15)"),this.my_gradient.addColorStop(1,"rgba(0, 0, 0, 0)"),this.context.fillStyle=this.my_gradient,this.context.fillRect(0,rc(this.offset2),rc(900),rc(150))}},this.start=function(){this.hideAd(),_cat=new catObject(_cat.id,_cat.name,100,70,413,0,_cat.money,_cat.items),this.clouds=[new cloudObject,new cloudObject,new cloudObject],this.enemies=[],this.coins=[new coinObject,new coinObject],null!=this.renderInterval&&clearInterval(this.renderInterval),this.renderInterval=setInterval("_game.tick()",this.fps),$("#controls").off("click"),$("#controls").click(function(){_cat.jump()}),$(document).off("keydown"),$(document).keydown(function(a){a?a:window.event;switch(a.keyCode){case 87:case 38:case 32:_cat.jump()}});var a=[];if(_cat.items.length>0)for(var b=0;b<_cat.items.length;b++){var c=_cat.items[b];switch(parseInt(c.type)){case 0:_cat.immortal=10*_gameConfig.fps,a.push(c.id_item);break;case 1:_cat.coinValue=2,a.push(c.id_item);break;case 2:_cat.milkyWay=!0,a.push(c.id_item)}}_cat.deleteItems(a),this.started=!0;var d=["invasion","wasteland","wreck"];_sounds.street.pause(),_sounds.hellfire.pause(),"undefined"!=typeof _sounds.ingame&&_sounds.ingame.pause(),_sounds.ingame=_sounds[d[Math.rand(0,d.length-1)]],_sounds.ingame.volume(.6),_sounds.ingame.play(),_sounds.ingame.on("ended",function(){_sounds.ingame=_sounds[d[Math.rand(0,d.length-1)]],_sounds.ingame.volume(.6),_sounds.ingame.play()},this)},this.pause=function(){this.started===!0&&clearInterval(this.renderInterval)},this.resume=function(){this.started===!0&&(clearInterval(this.renderInterval),this.renderInterval=setInterval("_game.tick()",this.fps))},this.stop=function(){this.started===!0&&(clearInterval(this.renderInterval),this.started=!1)},this.drawIntro=function(){_sounds.street.play(),this.showAd(),this.context.drawImage(c.logo,0,0,rc(900),rc(194))},this.drawGameOver=function(){_sounds.ingame.pause(),_sounds.street.play(),this.showAd(),this.context.clearRect(0,0,this.width,this.height),this.context_back.clearRect(0,0,this.width,this.height),this.drawIntro(),this.context.font=2*_game.fontsize+"px renegade_masternormal",this.context.fillText("game over",rc(275),rc(250))},this.initUser=function(){if(this.context.clearRect(0,0,this.width,this.height),_cat=new catObject(-1,"Guest",100,100,420,0,0,[]),"undefined"!=typeof localStorage.token&&"undefined"!=typeof localStorage.id){var a=encodeURIComponent(localStorage.id),b=encodeURIComponent(localStorage.token);_game.showLoading(),jQuery.support.cors=!0,$.getJSON(this.url+"auth/signInByToken?id="+a+"&token="+b,null,function(a){$("#menu").show(),_game.hideLoading(),0==a?(localStorage.removeItem("id"),localStorage.removeItem("token")):_game.logInLocal(a)})}else $("#menu").show();$("#menu").show()},this.logInLocal=function(a){_cat.id=a.id_user,_cat.name=a.nick,_cat.money=parseInt(a.money),_cat.items=a.items,localStorage.token=a.token,localStorage.id=a.id_user,$("#btn_signin, #btn_signup").hide(),$("#user_info").html(_cat.name),$("#user_info, #btn_signout, #btn_market").show(),TINY.box.hide()},this.signInDialog=function(){TINY.box.show({html:"<div><br><h2>sign in</h2><br><div id='signin_error'></div><table class='sign' border='0' cellspacing='2' cellpadding='2'><tr><th scope='row'>nick:</th><td><input type='text' id='nick'></td></tr><tr><th scope='row'>password:</th><td><input type='password' id='password'></td></tr></table><br><br><button style='font-size: "+_game.fontsize+"px' id='signin'>sign in</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){$("#signin").click(function(){_game.signIn()})}})},this.signIn=function(){var a=encodeURIComponent($("#nick").val()),b=encodeURIComponent(CryptoJS.SHA256($("#password").val()));jQuery.support.cors=!0,_game.showLoading(),$.getJSON(this.url+"auth/signIn?nick="+a+"&password="+b,null,function(a){0==a?$("#signin_error").html("User with this nick does not exist, or wrong password.<br>"):_game.logInLocal(a),_game.hideLoading()})},this.signUpDialog=function(){TINY.box.show({html:"<div><br><h2>sign up</h2><br><div id='signup_error'></div><table class='sign' border='0' cellspacing='2' cellpadding='2'><tr><th scope='row'>nick:</th><td><input type='text' id='nick'></td></tr><tr><th scope='row'>email (optional):</th><td><input type='text' id='email'></td></tr><tr><th scope='row'>password:</th><td><input type='password' id='password'></td></tr></table><br><br><button style='font-size: "+_game.fontsize+"px' id='signup'>sign up</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){$("#signup").click(function(){_game.signUp()})}})},this.signUp=function(){var a=encodeURIComponent($("#nick").val()),b=encodeURIComponent($("#email").val()),c=encodeURIComponent(CryptoJS.SHA256($("#password").val()));a.length<3||a.length>10?alertify.alert("Nick must have between 3 and 10 characters."):$("#password").val().length<3||$("#password").val().length>30?alertify.alert("Password must have between 3 and 30 characters."):(_game.showLoading(),jQuery.support.cors=!0,$.getJSON(this.url+"auth/signUp?nick="+a+"&email="+b+"&password="+c,null,function(a){0==a?$("#signup_error").html("User with this nick already exists.<br>"):_game.logInLocal(a),_game.hideLoading()}))},this.signOut=function(){_cat.id=-1,_cat.name="Guest",localStorage.removeItem("id"),localStorage.removeItem("token"),$("#btn_signin, #btn_signup").show(),$("#user_info").html(""),$("#btn_signout,#btn_market").hide(),this.stop()},this.showMarket=function(){this.pause(),TINY.box.show({html:"<div style='padding-top:2%'><div id='score_menu'><h2>Market (you have "+_cat.money+" coins)</h2></div> <hr><div id='market_content'></div><br><button style='font-size: "+_game.fontsize+"px' id='close_btn'>close</button></div>",width:parseInt(this.width),height:parseInt(this.height),openjs:function(){-1==_cat.id?$("#market_content").html("You must be logged in to shop in this market!"):($("#market_content").html("<br><br>loading market content..."),_game.updateMarket()),$("#close_btn").click(function(){TINY.box.hide(),_game.resume()}),$("#market_content").css({height:.68*_game.height+"px"})}})},this.updateMarket=function(){jQuery.support.cors=!0,_game.showLoading(),$.getJSON(_game.url+"market/init",null,function(a){if(0==a)$("#market_content").html("There was some problem while connectiong to market.<br>");else{var b="<div id='left'>left</div><div id='right'>right</div>";$("#market_content").html(b);var c="<h4>Your items</h4>";$.each(_cat.items,function(a,b){c+="<div class='item' id='"+b.id_item+"'><h4>"+b.name+"<span style='float:right'>$"+parseInt(b.price/2)+"</span></h4>"+b.description+"</div>"}),$("#left").html(c);var d="<h4>Market</h4>";$.each(a,function(a,b){for(var c=!1,e=0;e<_cat.items.length;e++)_cat.items[e].id_item==b.id_item&&(c=!0);c||(d+="<div class='item' id='"+b.id_item+"'><h4>"+b.name+"<span style='float:right'>$"+b.price+"</span></h4>"+b.description+"</div>")}),$("#right").html(d),$("#right .item").click(function(){$(this).off("click"),_game.buyItem(a,$(this).attr("id"))}),$("#left .item").click(function(){$(this).off("click"),_game.sellItem($(this).attr("id"))})}_game.hideLoading()})},this.buyItem=function(a,b){var c=null;$.each(a,function(a,d){d.id_item==b&&(c=d)}),null==c?(alertify.alert("Item not found. Error."),_game.updateMarket()):c.price>_cat.money?(alertify.alert("You don't have enough money to buy this."),_game.updateMarket()):alertify.confirm("Are you sure to buy "+c.name+" for "+c.price+" coins?",function(a){a?(_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"cat/buyItem?id_user="+_cat.id+"&id_item="+c.id_item+"&price="+c.price,null,function(a){0==a?alertify.alert("There was some problem while buying this item"):(_cat.money-=c.price,_cat.items.push(c)),_game.hideLoading(),_game.updateMarket()})):_game.updateMarket()})},this.sellItem=function(a){for(var b=null,c=-1,d=0;d<_cat.items.length;d++)_cat.items[d].id_item==a&&(b=_cat.items[d],c=d);var e=parseInt(b.price/2);null==b?(alertify.alert("Item not found. Error."),_game.updateMarket()):alertify.confirm("Are you sure to sell "+b.name+" for "+e+" coins?",function(a){a?(_game.showLoading(),jQuery.support.cors=!0,$.getJSON(_game.url+"cat/sellItem?id_user="+_cat.id+"&id_item="+b.id_item+"&price="+e,null,function(a){0==a?alertify.alert("There was some problem while selling this item"):(_cat.money+=e,_cat.items.splice(c,1)),_game.hideLoading(),_game.updateMarket()})):_game.updateMarket()})},this.vibrate=function(a){"true"!=_gameConfig.vibrate||"wp8"!=_gameConfig.device&&"android"!=_gameConfig.device||0!=this.vibrations||(navigator.notification.vibrate(a),this.vibrations=a/_gameConfig.fps)},this.showLoading=function(){$("#preload,#preload_overlay").css({display:"block"})},this.hideLoading=function(){$("#preload,#preload_overlay").css({display:"none"})}}function milkObject(){this.image=_images.milk,this.width=this.image.originalWidth,this.height=this.image.originalHeight,this.x=Math.rand(2e3,3500),this.y=Math.rand(0,520-this.height),this.draw=function(){_game.context.drawImage(this.image,rc(this.x),rc(this.y),rc(this.width),rc(this.height))},this.tick=function(){this.x-=parseInt(4*_game.speed),this.draw()}}function particleObject(a,b,c,d,e,f,g){this.x=parseInt(a),this.y=parseInt(b),this.width=parseInt(c),this.height=parseInt(d),this.itl=e,this.colors=f,this.direction=g,this.move=function(){switch(this.direction){case"down":this.y+=Math.rand(14,16);break;case"up":this.y-=Math.rand(14,16);break;case"right":this.x+=Math.rand(14,16)}},this.draw=function(){_game.context.fillStyle=f[Math.floor(Math.random()*f.length)],_game.context.fillRect(rc(this.x),rc(this.y),rc(this.width),rc(this.height))}}Math.rand=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)};var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(a){console.log("Received Event: "+a)}},_game,_cat,_images,_sounds,_math;$(document).ready(function(){app.initialize(),FastClick.attach(document.body),_math=mathjs();var a=document.getElementById("canvas"),b=a.getContext("2d"),c=0;_images=new Object,$.each(jsonFiles.images,function(a,b){_images[a]=new Image,_images[a].onload=function(){c++},_images[a].src="img/"+b.url,_images[a].originalWidth=parseInt(b.width),_images[a].originalHeight=parseInt(b.height)}),_sounds=new Object,$.each(jsonFiles.sounds,function(a,b){_sounds[a]=new Audio5js({swf_path:"lib/audio5js.swf",codecs:["mp3","vorbis"],ready:function(a){switch(a.codec){case"vorbis":this.load(b[1]);break;default:this.load(b[0])}}})}),_sounds.ingame=_sounds.street,null===localStorage.getItem("audio")?localStorage.audio=_gameConfig.audio:_gameConfig.audio=localStorage.audio,null===localStorage.getItem("vibrate")?localStorage.vibrate=_gameConfig.vibrate:_gameConfig.vibrate=localStorage.vibrate,null===localStorage.getItem("retro")?localStorage.retro=_gameConfig.retro:_gameConfig.retro=localStorage.retro;var d=setInterval(function(){c===_.size(jsonFiles.images)&&(clearInterval(d),_game=new gameObject(a,b,_images),_game.clouds=[],_game.enemies=[],_game.coins=[],_game.milks=[],_game.resize(),_game.initUser(),_game.drawIntro())},700)});var jsonAds={wp8:{ad320:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=147154040'></script>",width:320,height:50},ad468:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=830954974'></script>",width:468,height:60},ad640:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=198122772'></script>",width:640,height:100},ad720:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=340623132'></script>",width:720,height:90}},android:{ad468:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=549492589'></script>",width:468,height:60},ad640:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=543753494'></script>",width:640,height:100},ad720:{content:"<script type='text/javascript' src='http://ad.leadboltads.net/show_app_ad.js?section_id=978452527'></script>",width:720,height:90}}},jsonEnemies={p0:{enemy1:{type:"dog1",x:1500,y:200},enemy2:{type:"dog2",x:2e3,y:100},enemy3:{type:"dog3",x:2400,y:413}},p1:{enemy1:{type:"dog1",x:1400,y:100},enemy2:{type:"dog1",x:1500,y:400},enemy3:{type:"dog2",x:2100,y:320},enemy4:{type:"dog2",x:2400,y:90}},p2:{enemy1:{type:"dog2",x:1800,y:140},enemy2:{type:"dog3",x:1600,y:413},enemy3:{type:"dog3",x:2200,y:413}},p3:{enemy1:{type:"dog1",x:2100,y:140},enemy2:{type:"dog1",x:1600,y:270},enemy3:{type:"dog1",x:1400,y:400},enemy4:{type:"dog2",x:1750,y:350}},p4:{enemy1:{type:"dog2",x:1100,y:140},enemy2:{type:"dog2",x:1300,y:250},enemy4:{type:"dog3",x:2400,y:413}},p5:{enemy1:{type:"dog1",x:2e3,y:70},enemy2:{type:"dog1",x:3e3,y:80},enemy3:{type:"dog2",x:1e3,y:370},enemy4:{type:"dog2",x:1500,y:360}},p6:{enemy1:{type:"dog4",x:1500,y:383},enemy2:{type:"dog4",x:2e3,y:383},enemy3:{type:"dog1",x:2400,y:100}},p7:{enemy1:{type:"dog4",x:1300,y:383},enemy2:{type:"dog2",x:1700,y:50},enemy3:{type:"dog1",x:2200,y:250},enemy4:{type:"dog2",x:2e3,y:300},enemy5:{type:"dog4",x:2600,y:383},enemy6:{type:"dog1",x:3900,y:220}}},jsonFiles={images:{cat:{url:"cat.png",width:"222",height:"114"},dog1:{url:"dog1.png",width:"288",height:"75"},dog2:{url:"dog2.png",width:"294",height:"129"},dog3:{url:"dog3.png",width:"384",height:"120"},dog4:{url:"dog4.png",width:"252",height:"150"},cloud1:{url:"cloud1.png",width:"300",height:"90"},cloud2:{url:"cloud2.png",width:"360",height:"120"},country:{url:"country.jpg",width:"1601",height:"600"},country2:{url:"country2.jpg",width:"1601",height:"600"},country3:{url:"country3.jpg",width:"1601",height:"600"},country4:{url:"country4.jpg",width:"1601",height:"600"},country5:{url:"country5.jpg",width:"1601",height:"600"},coin:{url:"coin.png",width:"42",height:"42"},milk:{url:"milk.png",width:"42",height:"57"},logo:{url:"logo.png",width:"900",height:"194"}},sounds:{thud:["audio/thud.mp3","audio/thud.ogg","Michel Baradari"],street:["audio/street.mp3","audio/street.ogg","Zander Noriega"],wasteland:["audio/wasteland.mp3","audio/wasteland.ogg","Kris Dudley"],invasion:["audio/invasion.mp3","audio/invasion.ogg","Kris Dudley"],wreck:["audio/wreck.mp3","audio/wreck.ogg","Zander Noriega"],hellfire:["audio/hellfire.mp3","audio/hellfire.ogg","Zander Noriega"],bark1:["audio/bark1.mp3","audio/bark1.ogg","Paulius Jurgelevičius"],bark2:["audio/bark2.mp3","audio/bark2.ogg","Paulius Jurgelevičius"],bark3:["audio/bark3.mp3","audio/bark3.ogg","bart"],bark4:["audio/bark4.mp3","audio/bark4.ogg","bart"],pain1:["audio/pain1.mp3","audio/pain1.ogg","Stigler"],pain2:["audio/pain2.mp3","audio/pain2.ogg","Stigler"],pain3:["audio/pain3.mp3","audio/pain3.ogg","Stigler"]}};
